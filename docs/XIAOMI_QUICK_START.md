# 米家设备快速配置指南

本指南提供最简单、最可靠的米家设备配置方法。

## 🎯 推荐方案：HACS + Xiaomi Home

这是目前最稳定、最简单的方案，可以避免各种登录问题。

### 总览

```
安装 HACS → 下载 Xiaomi Home → 扫码登录 → 完成
   ↓            ↓                ↓           ↓
 5 分钟       2 分钟           1 分钟      自动发现设备
```

---

## 第一步：安装 HACS（5 分钟）

### 1.1 运行安装命令

```bash
# 进入容器并安装
docker exec -it homeassistant bash
wget -O - https://get.hacs.xyz | bash -
exit

# 重启 Home Assistant
docker-compose restart homeassistant
```

### 1.2 等待启动

等待 30-60 秒，让 Home Assistant 完全启动。

### 1.3 配置 HACS

1. 访问 `http://localhost:8123`
2. 进入 **设置** > **设备与服务**
3. 找到 **HACS**，点击配置
4. 同意条款
5. 使用 GitHub 账号授权（如果没有，先注册一个）
6. 完成配置

⚠️ **提示**：如果 URL 跳转到 `homeassistant.local`，手动改为 `localhost`

---

## 第二步：安装 Xiaomi Home 集成（2 分钟）

### 2.1 打开 HACS

在 Home Assistant 左侧菜单点击 **HACS**

### 2.2 搜索并下载

1. 点击 **集成** 标签
2. 点击右下角 **+ 浏览并下载存储库**
3. 搜索：**Xiaomi Home**
4. 点击 **Xiaomi Home**
5. 点击 **下载**
6. 选择最新版本
7. 点击 **下载**

### 2.3 重启 Home Assistant

```bash
docker-compose restart homeassistant
```

等待 30 秒。

---

## 第三步：配置 Xiaomi Home（1 分钟）

### 3.1 添加集成

1. 访问 `http://localhost:8123`
2. 进入 **设置** > **设备与服务**
3. 点击 **+ 添加集成**
4. 搜索：**Xiaomi Home**
5. 点击选择

### 3.2 选择登录方式

**推荐：扫码登录** ⭐

1. 选择 **扫码登录**
2. 打开米家 app
3. 扫描屏幕上的二维码
4. 在手机上确认授权
5. 完成！

**备选：账号密码登录**

1. 输入小米账号（手机号或邮箱）
2. 输入密码
3. 选择服务器区域（中国选 **中国**）
4. 提交

### 3.3 等待设备发现

- 系统会自动发现你的米家设备
- 通常需要 1-3 分钟
- 发现后会显示设备列表

### 3.4 选择设备

1. 勾选要添加的设备
2. 点击 **提交**
3. 完成！设备已添加到 Home Assistant

---

## 验证配置

### 检查设备

1. 进入 **设置** > **设备与服务**
2. 点击 **Xiaomi Home**
3. 查看已添加的设备列表

### 测试控制

1. 进入 **概览** 页面
2. 找到你的米家设备
3. 尝试控制（开关、调节等）
4. 确认设备响应正常

---

## 常见问题

### Q: 没有 GitHub 账号怎么办？

**解决方案**：
1. 访问 https://github.com/signup
2. 免费注册一个账号（只需邮箱）
3. 用于 HACS 授权

### Q: 扫码登录失败？

**解决方案**：
1. 确保米家 app 已登录
2. 确保手机和电脑在同一网络
3. 尝试重新生成二维码
4. 或使用账号密码登录

### Q: 设备没有被发现？

**解决方案**：
1. 确认设备在米家 app 中在线
2. 等待更长时间（最多 5 分钟）
3. 重新加载集成：
   - 进入"设置" > "设备与服务"
   - 找到 Xiaomi Home
   - 点击"重新加载"

### Q: 某些设备不支持？

**解决方案**：
1. 检查 Xiaomi Home 集成的支持列表
2. 尝试更新到最新版本
3. 在 GitHub 上提交 issue 请求支持

### Q: 想卸载 HACS？

**解决方案**：
```bash
docker exec -it homeassistant bash
rm -rf /config/custom_components/hacs
exit
docker-compose restart homeassistant
```

---

## 对比：不同集成方式

| 特性 | HACS + Xiaomi Home | 官方 Xiaomi Miio |
|------|-------------------|------------------|
| 安装难度 | 中等（需要 HACS） | 简单（内置） |
| 登录方式 | 扫码 / 账号密码 | 仅账号密码 |
| 登录成功率 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 设备支持 | 更多 | 较少 |
| 功能完整性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 更新频率 | 频繁 | 较慢 |
| 推荐度 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

---

## 下一步

配置完成后，你可以：

1. **创建自动化**：
   - 进入"设置" > "自动化与场景"
   - 创建基于米家设备的自动化

2. **集成到 HomeKit**：
   - 查看 [HomeKit 配置指南](HOMEKIT_SETUP.md)
   - 将米家设备桥接到 iPhone 家庭 app

3. **安装更多集成**：
   - 在 HACS 中浏览其他有用的集成
   - 安装主题美化界面

4. **优化配置**：
   - 调整设备名称
   - 设置房间分组
   - 配置设备图标

---

## 获取帮助

- **详细文档**：[Xiaomi 配置指南](XIAOMI_SETUP.md)
- **HACS 文档**：[HACS 安装指南](HACS_INSTALLATION.md)
- **故障排除**：[故障排除指南](TROUBLESHOOTING.md)
- **快速修复**：[快速修复指南](QUICK_FIX_MDNS.md)

---

**祝你配置顺利！享受智能家居的乐趣！** 🎉
